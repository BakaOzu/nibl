// Generated by CoffeeScript 1.7.1
(function() {
  'use strict';
  angular.module('niblApp').controller('sidebarCtrl', function($scope, taskService, Restangular) {
    var beforeEditTask;
    $scope.sidebarMode = 'news';
    $scope.currentTask = {};
    beforeEditTask = {};
    $scope.startTaskCreation = function() {
      $scope.sidebarMode = 'taskCreation';
      $scope.currentTask = {};
      return beforeEditTask = {};
    };
    $scope.edit = function(task) {
      beforeEditTask = task;
      $scope.currentTask = Restangular.copy(task);
      return $scope.sidebarMode = 'taskEdition';
    };
    $scope.save = function(task) {
      if ($scope.sidebarMode === 'taskEdition') {
        task.put().then(function() {
          var last;
          last = Restangular.one('get_last').get().$object;
          $scope.tasks = _.without($scope.tasks, task);
          return $scope.tasks.push(last);
        });
      } else {
        taskService.post(task).then(function() {
          return Restangular.one('get_last').get().then(function(data) {
            $scope.tasks.push(data);
            return console.log(data);
          });
        }, function(error) {
          return console.log(error);
        });
      }
      return $scope.sidebarMode = 'taskDetail';
    };
    $scope.discard = function() {
      $scope.sidebarMode = 'taskDetail';
      return $scope.currentTask = beforeEditTask;
    };
    return $scope["delete"] = function(task) {
      $scope.sidebarMode = 'news';
      console.log(task);
      task.remove().then(function() {});
      return $scope.tasks = _.without($scope.tasks, task, function(error) {
        return console.log(error);
      });
    };
  });

}).call(this);
